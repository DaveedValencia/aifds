{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aifds.org/schemas/v1/product.schema.json",
  "title": "AIFDS Commerce Product (v1 draft)",
  "description": "Canonical representation of a single shoppable SKU aligned with schema.org/Product.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "@context": { "const": "https://schema.org" },
    "@type": { "const": "Product" },
    "@id": {
      "description": "Stable URI for this product. Can be canonical product URL or a GUID with urn: prefix.",
      "type": "string",
      "minLength": 1
    },
    "sku": { "type": "string", "minLength": 1 },
    "gtin13": {
      "description": "13-digit GTIN (if applicable).",
      "type": "string",
      "pattern": "^\\d{13}$"
    },
    "mpn": {
      "description": "Manufacturer part number.",
      "type": "string",
      "minLength": 1
    },
    "name": { "type": "string", "minLength": 1 },
    "description": { "type": "string", "minLength": 1 },
    "url": { "type": "string", "format": "uri" },
    "image": {
      "description": "Primary product imagery.",
      "oneOf": [
        { "type": "string", "format": "uri" },
        {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "format": "uri" }
        }
      ]
    },
    "category": { "type": "string" },
    "productGroupID": {
      "description": "Identifier for grouping variants (e.g., Shopify product ID).",
      "type": ["string", "integer"]
    },
    "releaseDate": { "type": "string", "format": "date" },
    "brand": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "@type": { "const": "Brand" },
        "name": { "type": "string", "minLength": 1 },
        "logo": { "type": "string", "format": "uri" },
        "url": { "type": "string", "format": "uri" }
      },
      "required": ["@type", "name"]
    },
    "material": { "type": "string" },
    "color": { "type": "string" },
    "size": {
      "description": "Named size or size code.",
      "type": ["string", "number"]
    },
    "keywords": {
      "description": "Searchable merchandising tags.",
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "uniqueItems": true,
      "maxItems": 30
    },
    "offers": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "@type": { "const": "Offer" },
        "price": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]{2})?$",
          "description": "Price inclusive of currency minor units."
        },
        "priceCurrency": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "ISO-4217 currency code."
        },
        "availability": {
          "type": "string",
          "enum": [
            "https://schema.org/InStock",
            "https://schema.org/OutOfStock",
            "https://schema.org/PreOrder",
            "https://schema.org/LimitedAvailability"
          ]
        },
        "itemCondition": {
          "type": "string",
          "enum": [
            "https://schema.org/NewCondition",
            "https://schema.org/RefurbishedCondition",
            "https://schema.org/UsedCondition"
          ]
        },
        "url": { "type": "string", "format": "uri" },
        "shippingDetails": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "@type": { "const": "OfferShippingDetails" },
            "shippingDestination": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "@type": { "const": "DefinedRegion" },
                "addressCountry": { "type": "string", "minLength": 2, "maxLength": 2 }
              },
              "required": ["@type", "addressCountry"]
            },
            "shippingRate": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "@type": { "const": "MonetaryAmount" },
                "value": {
                  "type": "string",
                  "pattern": "^[0-9]+(\\.[0-9]{2})?$"
                },
                "currency": {
                  "type": "string",
                  "pattern": "^[A-Z]{3}$"
                }
              },
              "required": ["@type", "value", "currency"]
            }
          }
        }
      },
      "required": ["@type", "price", "priceCurrency", "availability", "url"]
    },
    "aggregateRating": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "@type": { "const": "AggregateRating" },
        "ratingValue": {
          "type": "number",
          "minimum": 0,
          "maximum": 5
        },
        "reviewCount": {
          "type": "integer",
          "minimum": 0
        }
      },
      "required": ["@type", "ratingValue", "reviewCount"]
    },
    "review": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "@type": { "const": "Review" },
          "author": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "@type": { "const": "Person" },
              "name": { "type": "string", "minLength": 1 }
            },
            "required": ["@type", "name"]
          },
          "reviewBody": { "type": "string", "minLength": 1 },
          "reviewRating": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "@type": { "const": "Rating" },
              "ratingValue": { "type": "number", "minimum": 0, "maximum": 5 }
            },
            "required": ["@type", "ratingValue"]
          },
          "datePublished": { "type": "string", "format": "date" }
        },
        "required": ["@type", "author", "reviewBody", "reviewRating"]
      },
      "maxItems": 50
    },
    "hasVariant": {
      "description": "Variant SKUs linked to this base product.",
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "uniqueItems": true,
      "maxItems": 100
    },
    "lastModified": {
      "description": "Timestamp the product payload was last regenerated.",
      "type": "string",
      "format": "date-time"
    }
  },
  "required": ["@context", "@type", "sku", "name", "description", "url", "offers", "lastModified"]
}
